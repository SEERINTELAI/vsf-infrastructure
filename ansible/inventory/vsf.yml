# VSF (Virtual Server Farm) Ansible Inventory
# Defines all VMs for the 24-node virtualized server farm on Bizon1

all:
  vars:
    ansible_user: ubuntu
    ansible_ssh_private_key_file: ~/.ssh/vsf_key
    ansible_python_interpreter: /usr/bin/python3
    
    # K3s configuration
    k3s_version: "v1.29.0+k3s1"
    k3s_token: "{{ lookup('env', 'K3S_TOKEN') | default('vsf-cluster-token-changeme', true) }}"
    
    # Cluster networking
    cluster_cidr: "10.42.0.0/16"
    service_cidr: "10.43.0.0/16"
    cluster_dns: "10.43.0.10"
    
  children:
    # Control plane nodes (3-node HA with embedded etcd)
    control_plane:
      hosts:
        vsf-cp-1:
          ansible_host: 192.168.100.11
          k3s_role: server
          k3s_init: true  # First node initializes the cluster
        vsf-cp-2:
          ansible_host: 192.168.100.12
          k3s_role: server
          k3s_init: false
        vsf-cp-3:
          ansible_host: 192.168.100.13
          k3s_role: server
          k3s_init: false
      vars:
        node_labels:
          - "node-role.kubernetes.io/control-plane=true"
          - "vsf/node-type=control-plane"
    
    # Standard worker nodes - Batch 1 (Task 107)
    workers_batch_1:
      hosts:
        vsf-worker-1:
          ansible_host: 192.168.100.21
        vsf-worker-2:
          ansible_host: 192.168.100.22
        vsf-worker-3:
          ansible_host: 192.168.100.23
        vsf-worker-4:
          ansible_host: 192.168.100.24
        vsf-worker-5:
          ansible_host: 192.168.100.25
      vars:
        k3s_role: agent
        node_labels:
          - "node-role.kubernetes.io/worker=true"
          - "vsf/node-type=standard"
          - "vsf/batch=1"
    
    # Standard worker nodes - Batch 2 (Task 108)
    workers_batch_2:
      hosts:
        vsf-worker-6:
          ansible_host: 192.168.100.26
        vsf-worker-7:
          ansible_host: 192.168.100.27
        vsf-worker-8:
          ansible_host: 192.168.100.28
        vsf-worker-9:
          ansible_host: 192.168.100.29
        vsf-worker-10:
          ansible_host: 192.168.100.30
      vars:
        k3s_role: agent
        node_labels:
          - "node-role.kubernetes.io/worker=true"
          - "vsf/node-type=standard"
          - "vsf/batch=2"
    
    # All standard workers (combined group)
    workers:
      children:
        workers_batch_1:
        workers_batch_2:
    
    # GPU worker nodes (8 nodes with GPU passthrough)
    gpu_workers:
      hosts:
        vsf-gpu-1:
          ansible_host: 192.168.100.41
        vsf-gpu-2:
          ansible_host: 192.168.100.42
        vsf-gpu-3:
          ansible_host: 192.168.100.43
        vsf-gpu-4:
          ansible_host: 192.168.100.44
        vsf-gpu-5:
          ansible_host: 192.168.100.45
        vsf-gpu-6:
          ansible_host: 192.168.100.46
        vsf-gpu-7:
          ansible_host: 192.168.100.47
        vsf-gpu-8:
          ansible_host: 192.168.100.48
      vars:
        k3s_role: agent
        node_labels:
          - "node-role.kubernetes.io/worker=true"
          - "vsf/node-type=gpu"
          - "nvidia.com/gpu.present=true"
        node_taints:
          - "nvidia.com/gpu=true:NoSchedule"
    
    # All worker nodes (for convenience)
    all_workers:
      children:
        workers:
        gpu_workers:
    
    # All K3s nodes
    k3s_cluster:
      children:
        control_plane:
        all_workers:
